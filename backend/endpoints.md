# API Endpoints - Backend Watsonx

## Base URL
```
http://localhost:8080/api
```

---

## 1. POST /send-prompt

Sends a prompt to Watsonx and receives a processed response.

### Request

**Method:** POST  
**Content-Type:** application/json

#### Body
```json
{
  "content": "string",
  "email": "string"
}
```

#### Parameters
| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| `content` | string | ✅ Yes | The prompt/question to be sent to Watsonx |
| `email` | string | ✅ Yes | User's email for notification delivery |

#### Example Request
```bash
curl -X POST http://localhost:8080/api/send-prompt \
  -H "Content-Type: application/json" \
  -d '{
    "content": "Explain the concept of machine learning",
    "email": "user@example.com"
  }'
```

### Response

**Status Code:** 200 OK  
**Content-Type:** application/json

#### Body
```json
{
  "content": "string",
  "modelId": "string",
  "id": "string",
  "createdAt": number
}
```

#### Fields
| Field | Type | Description |
|-------|------|-------------|
| `content` | string | The response generated by Watsonx |
| `modelId` | string | Identifier of the Watsonx model used |
| `id` | string | Unique ID of the request/response |
| `createdAt` | number | Timestamp (milliseconds) of creation time |

#### Example Response
```json
{
  "content": "Machine Learning is a subfield of artificial intelligence that focuses on developing algorithms and statistical models that enable computers to learn and improve their performance on a specific task...",
  "modelId": "ibm-watsonx-13b",
  "id": "550e8400-e29b-41d4-a716-446655440000",
  "createdAt": 1738420800000
}
```

---

## 2. POST /send-prompt-with-csv

Sends a prompt along with a CSV file to provide additional context to Watsonx.

### Request

**Method:** POST  
**Content-Type:** multipart/form-data

#### Parameters
| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| `prompt` | string | ✅ Yes | The prompt/question to be sent to Watsonx |
| `email` | string | ✅ Yes | User's email for notification delivery |
| `csvFile` | file | ✅ Yes | CSV file to provide context (max. 5MB) |

#### Example Request
```bash
curl -X POST http://localhost:8080/api/send-prompt-with-csv \
  -F "prompt=Analyze the sales pattern" \
  -F "email=user@example.com" \
  -F "csvFile=@sales_data.csv"
```

#### CSV File Format
Example of expected structure:
```csv
Date,Product,Category,Sales,Region
2024-01-01,Product A,Electronics,1500,South
2024-01-02,Product B,Clothing,800,North
2024-01-03,Product C,Electronics,2100,Southeast
```

### Response

**Status Code:** 200 OK  
**Content-Type:** application/json

#### Body
```json
{
  "content": "string",
  "modelId": "string",
  "id": "string",
  "createdAt": number
}
```

#### Fields (same as previous endpoint)
| Field | Type | Description |
|-------|------|-------------|
| `content` | string | The response generated by Watsonx with CSV data analysis |
| `modelId` | string | Identifier of the Watsonx model used |
| `id` | string | Unique ID of the request/response |
| `createdAt` | number | Timestamp (milliseconds) of creation time |

#### Example Response
```json
{
  "content": "Based on the analysis of the provided CSV data, I identified the following patterns: 1) The Southeast region shows the highest sales volume with 2,100 units... 2) The Electronics category is the most profitable...",
  "modelId": "ibm-watsonx-13b",
  "id": "660e8400-e29b-41d4-a716-446655440001",
  "createdAt": 1738420860000
}
```

---

## Error Responses

### 400 Bad Request
```json
{
  "timestamp": "2024-02-01T12:00:00.000Z",
  "status": 400,
  "error": "Bad Request",
  "message": "Invalid email or empty prompt"
}
```

### 500 Internal Server Error
```json
{
  "timestamp": "2024-02-01T12:00:00.000Z",
  "status": 500,
  "error": "Internal Server Error",
  "message": "Error processing the request in Watsonx"
}
```

---

## Processing Flow

1. Client sends request to one of the endpoints
2. Controller validates the parameters
3. WatsonxService processes the prompt/CSV
4. Response is generated by the Watsonx model
5. Notification email is sent to the user
6. Response is returned to the client

---

## Important Notes

- ✅ All required fields must be filled
- ✅ The email must be valid for notification delivery
- ✅ The CSV in endpoint 2 will be processed and used as context
- ✅ Responses are processed asynchronously
- ✅ The returned ID can be used for tracking
